# OCP Data Model (Minimized)

## DB: MongoDB (Off-Chain API Source)

### Core Entities
Ent:Issuer Flds:_id:String(UUID), object_type:"ISSUER", legal_name:String, dba:String, formation_date:String, country_of_formation:String, country_subdivision_of_formation:String, tax_ids:Array, email:Object, phone:Object, address:Object, initial_shares_authorized:String, comments:Array(String), deployed_to:String(Addr), last_processed_block:Number, is_manifest_created:Bool, chain_id:Number, tx_hash:String Sync:is_onchain_synced,tx_hash
Ent:Stakeholder Flds:_id:String(UUID), object_type:"STAKEHOLDER", name:Object, stakeholder_type:String, issuer_assigned_id:String, current_relationship:String, primary_contact:Object, contact_info:Object, comments:Array(String), issuer:String(Ref>Issuer), addresses:Array(Object), tax_ids:Array(Object) Sync:is_onchain_synced,tx_hash
Ent:StockClass Flds:_id:String(UUID), object_type:"STOCK_CLASS", name:String, class_type:String, default_id_prefix:String, initial_shares_authorized:String, board_approval_date:String, votes_per_share:String, par_value:Object, price_per_share:Object, seniority:String, conversion_rights:Object, liquidation_preference_multiple:String, participation_cap_multiple:String, comments:Array(String), issuer:String(Ref>Issuer) Sync:is_onchain_synced,tx_hash
Ent:StockPlan Flds:_id:String(UUID), object_type:"STOCK_PLAN", name:String, board_approval_date:String, initial_shares_reserved:String, stock_class_id:String(Ref>StockClass), comments:Array(String), issuer:String(Ref>Issuer) Sync:is_onchain_synced,tx_hash
Ent:VestingTerms Flds:_id:String(UUID), object_type:"VESTING_TERMS", name:String, description:String, comments:Array(String), issuer:String(Ref>Issuer)
Ent:Valuation Flds:_id:String(UUID), object_type:"VALUATION", issuer:String(Ref>Issuer), effective_date:String, post_money_valuation:Object, board_approval_date:String, comments:Array(String)

### Transaction Entities (Examples)
Ent:StockIssuance Flds:_id:String(UUID), object_type:"TX_STOCK_ISSUANCE", stock_class_id:String(Ref>StockClass), stock_plan_id:String(Ref>StockPlan), share_numbers_issued:Array(Object), share_price:Object, quantity:String, vesting_terms_id:String(Ref>VestingTerms), cost_basis:Object, stock_legend_ids:Array(String), issuance_type:String, comments:Array(String), security_id:String, date:String, custom_id:String, stakeholder_id:String(Ref>Stakeholder), board_approval_date:String, stockholder_approval_date:String, consideration_text:String, security_law_exemptions:Array(Object), issuer:String(Ref>Issuer) Sync:is_onchain_synced,tx_hash
# Other Tx Types: EquityCompensationIssuance, ConvertibleIssuance, WarrantIssuance, StockTransfer, StockCancellation, StockConsolidation, EquityCompensationExercise, Acceptance, Adjustment, Conversion, Release, Repurchase, ReturnToPool, Split, etc.

### Relationships
# OneToMany: Issuer -> Stakeholders, StockClasses, StockPlans, Valuations, Transactions
# ManyToOne: Transactions -> Stakeholder, StockClass, StockPlan, VestingTerms
# Refs: Use String(UUID) IDs

### Sync Fields (Common)
# is_onchain_synced:Bool, tx_hash:String

## BC: Blockchain (Solidity - On-Chain Diamond Pattern)

### Core Storage
Struct:Storage Flds:roles:mapping(bytes32=>mapping(address=>bool)), roleAdmin:mapping(bytes32=>bytes32), currentAdmin:address, pendingAdmin:address, issuer:Issuer, stakeholders:bytes16[], stakeholderIndex:mapping(bytes16=>uint256), stockClasses:StockClass[], stockClassIndex:mapping(bytes16=>uint256), stockPlans:StockPlan[], stockPlanIndex:mapping(bytes16=>uint256), stockActivePositions:StockActivePositions, convertibleActivePositions:ConvertibleActivePositions, equityCompensationActivePositions:EquityCompensationActivePositions, warrantActivePositions:WarrantActivePositions, addressToStakeholderId:mapping(address=>bytes16)

### Primary Entity Structs
Struct:Issuer Flds:id:bytes16, shares_issued:uint256, shares_authorized:uint256
Struct:StockClass Flds:id:bytes16, class_type:string, shares_issued:uint256, price_per_share:uint256, shares_authorized:uint256
Struct:StockPlan Flds:stock_class_ids:bytes16[], shares_reserved:uint256

### Security Position Structs
Struct:StockActivePosition Flds:stakeholder_id:bytes16, stock_class_id:bytes16, quantity:uint256, share_price:uint256
Struct:ConvertibleActivePosition Flds:stakeholder_id:bytes16, investment_amount:uint256
Struct:EquityCompensationActivePosition Flds:stakeholder_id:bytes16, quantity:uint256, timestamp:uint40, stock_class_id:bytes16, stock_plan_id:bytes16
Struct:WarrantActivePosition Flds:stakeholder_id:bytes16, quantity:uint256

### Transaction Parameter Structs (Examples)
Struct:IssueStockParams Flds:id:bytes16, stock_class_id:bytes16, share_price:uint256, quantity:uint256, stakeholder_id:bytes16, security_id:bytes16, custom_id:string, stock_legend_ids_mapping:string, security_law_exemptions_mapping:string
# Other Param Structs: IssueConvertibleParams, IssueEquityCompensationParams, IssueWarrantParams, StockConsolidationTx, StockTransferTx, StockCancellationTx, etc.

### Diamond Facets
# Facet:StockFacet, StakeholderFacet, IssuerFacet, StockClassFacet, ConvertiblesFacet, EquityCompensationFacet, StockPlanFacet, WarrantFacet, AccessControlFacet, StakeholderNFTFacet

### Mappings (Examples)
# stakeholderToSecurities: mapping(bytes16 => bytes16[])
# securities: mapping(bytes16 => SecurityDetails) # Assume SecurityDetails struct exists
# securityToStakeholder: mapping(bytes16 => bytes16)
# addressToStakeholderId: mapping(address => bytes16)
# Indices: stakeholderIndex, stockClassIndex, stockPlanIndex

### Access Control Roles
# Role:ADMIN_ROLE (Full Control), OPERATOR_ROLE (Operations), INVESTOR_ROLE (View Own)

### Synchronization Info (Implicit)
# Events (TxCreated, StakeholderCreated, StockClassCreated, StockPlanCreated) drive DB sync.
# DB fields `deployed_to`, `chain_id`, `tx_hash`, `is_onchain_synced`, `last_processed_block` track sync state.