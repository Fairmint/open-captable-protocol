# Conf: OCP Configuration System

## Core Concepts
# Arch: Environment-based: .env files (.local, .dev, .prod) + runtime Env Vars + BC network configs.
# Load: `setupEnv()` (`src/utils/env.js`) uses runtime if `DOCKER_ENV=true`, else loads `.env` via `USE_ENV_FILE` var (defaults to `.env`).

## Config Categories & Key Variables

Conf:Database (MongoDB)
  Vars: `DATABASE_URL`, `DATABASE_REPLSET`("1" if replSet), `DATABASE_OVERRIDE`(optional name).
  Usage: Connects via `src/db/config/mongoose.ts`.

Conf:Blockchain Network (Single Instance Context)
  Vars: `RPC_URL`, `CHAIN_ID`, `PRIVATE_KEY`.

Conf:Multi-Chain Support
  Logic: System handles multiple networks.
  Vars: Specific RPCs per chain (e.g., `BASE_RPC_URL`, `BASE_SEPOLIA_RPC_URL`).
  Defs: Supported chains in `src/utils/chains.js` (maps chainId to name, rpcUrl, wsUrl).
  Routing: Middleware (`src/app.js`) uses `req.body.chain_id` to select config/provider.

Conf:Websocket Listener (`src/utils/websocket.ts`)
  Vars: `WS_RECONNECT_INTERVAL`, `WS_MAX_RECONNECT_ATTEMPTS`, `EVENT_FILTER_FROM_BLOCK`(start block, 0=deployment).
  Ops: Monitors contract events across chains, groups contracts by chain_id.

Conf:Contract Instance Caching
  Vars: `CONTRACT_CACHE_TTL`(secs), `MAX_CACHED_CONTRACTS`.
  Impl: Middleware (`src/app.js`) caches contract instances based on `issuerId` & `chain_id`.

Conf:Smart Contract Addresses
  Vars: `FACTORY_ADDRESS`, `REFERENCE_DIAMOND`, `DIAMOND_CUT_FACET`, `ISSUER_FACET`, `STAKEHOLDER_FACET`, `STOCK_CLASS_FACET`, ... (all other deployed facets).
  Usage: Used by `src/chain-operations/getContractInstances.js`.

Conf:API Server (Express)
  Vars: `PORT`, `SENTRY_DSN`(optional).

## Deployment
# Scripts: `deploy:local`, `deploy:testnet`, `deploy:mainnet` (`deploy_factory.sh`).
# Mapping: Each script loads corresponding `.env` file (`.env.local`, `.env.dev`, `.env.prod`).
# Safety: Prompts/checks for non-local deploys.

## Management & Best Practices (Summary)
# Add new vars to all `.env` files. Access via `process.env`.
# NEVER commit secrets (.env files should be gitignored).
# Validate required config on startup. Use descriptive var names.